<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="https://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8">
    <title>Quản lý Đánh giá</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <!-- Favicon -->
    <link rel="shortcut icon" th:href="@{/assets/img/favicon.svg}">
    <!-- Bootstrap min.css -->
    <link rel="stylesheet" th:href="@{/assets/css/bootstrap.min.css}">
    <!-- All Min Css -->
    <link rel="stylesheet" th:href="@{/assets/css/all.min.css}">
    <!-- Animate.css -->
    <link rel="stylesheet" th:href="@{/assets/css/animate.css}">
    <!-- Magnific Popup.css -->
    <link rel="stylesheet" th:href="@{/assets/css/magnific-popup.css}">
    <!-- MeanMenu.css -->
    <link rel="stylesheet" th:href="@{/assets/css/meanmenu.css}">
    <!-- Swiper Bundle.css -->
    <link rel="stylesheet" th:href="@{/assets/css/swiper-bundle.min.css}">
    <!-- Nice Select.css -->
    <link rel="stylesheet" th:href="@{/assets/css/nice-select.css}">
    <!-- Icomon.css -->
    <link rel="stylesheet" th:href="@{/assets/css/icomon.css}">
    <!-- Main.css -->
    <link rel="stylesheet" th:href="@{/assets/css/main.css}">
    <style>
        .table-hover tbody tr:hover {
            background-color: #f5f5f5;
        }
        .pagination-controls {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-top: 20px;
        }
        .pagination-controls .btn {
            margin: 0 5px;
        }
        .search-bar {
            margin-bottom: 20px;
        }
        body {
            padding-top: 30px; /* Điều chỉnh theo chiều cao header */
            margin-top: 50px;
        }
        .main-content {
            margin-bottom: 50px; /* Khoảng cách với footer */
        }
        .bg-cover{
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
<div th:replace="~{fragments/header :: header}"></div>

<div class="container mt-4 main-content">
    <!-- GT Breadcrumb Section Start -->
    <div class="gt-breadcrumb-wrapper bg-cover" style="background-image: url('/assets/img/breadcrumb-bg.jpg');">
        <div class="gt-right-shape"><img src="/assets/img/breadcrumb-shape.jpg" alt="img"></div>
        <div class="container">
            <div class="gt-page-heading">
                <div class="gt-breadcrumb-sub-title">
                    <h1 class="wow fadeInUp" data-wow-delay=".3s">Quản lý Đánh giá</h1>
                </div>
                <ul class="gt-breadcrumb-items wow fadeInUp" data-wow-delay=".5s">
                    <li><a href="/home">Trang Chủ</a></li>
                    <li><i class="fa-solid fa-chevron-right"></i></li>
                    <li>Quản lý Đánh giá</li>
                </ul>
            </div>
        </div>
    </div>

    <div th:if="${error}" class="alert alert-danger" th:text="${error}"></div>
    <div th:if="${success}" class="alert alert-success" th:text="${success}"></div>

    <div class="search-bar">
        <form th:action="@{/admin/ratings}" method="get" class="d-flex">
            <input type="text" name="searchTerm" class="form-control me-2" placeholder="Tìm kiếm theo Dịch vụ hoặc Kỹ thuật viên" th:value="${searchTerm}">
            <input type="hidden" name="page" th:value="${currentPage}">
            <input type="hidden" name="size" th:value="${pageSize}">
            <input type="hidden" name="sortBy" th:value="${sortBy}">
            <input type="hidden" name="sortDir" th:value="${sortDir}">
            <button type="submit" class="btn btn-primary">Tìm kiếm</button>
            <a th:href="@{/admin/ratings(page=${currentPage}, size=${pageSize}, sortBy=${sortBy}, sortDir=${sortDir})}" class="btn btn-secondary ms-2">Đặt lại</a>
        </form>
    </div>

    <div class="table-responsive">
        <table class="table table-bordered table-hover">
            <thead class="table-dark">
            <tr>
                <th>ID</th>
                <th>Tên Khách hàng</th>
                <th>Điểm đánh giá</th>
                <th>Nội dung đánh giá</th>
                <th>Dịch vụ</th>
                <th>Kỹ thuật viên</th>
                <th>Thời gian bắt đầu</th>
                <th>Thời gian kết thúc</th>
                <th>Thời gian đánh giá</th>
                <th>Hành động</th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="rating : ${ratingPage.content}">
                <td th:text="${rating.id}"></td>
                <td th:text="${rating.user.name}"></td> <td>
                    <span th:each="i : ${#numbers.sequence(1, 5)}"
                          th:classappend="${i <= rating.rating ? 'text-warning' : 'text-muted'}">
                        <i class="fas fa-star"></i> </span>
                <span th:text="${rating.rating}"></span> </td>
                <td th:text="${rating.comment}"></td>
                <td th:text="${rating.appointment.service.name}"></td> <td th:text="${rating.appointment.technician.name}"></td> <td th:text="${#temporals.format(rating.appointment.startTime, 'dd-MM-yyyy HH:mm')}"></td> <td th:text="${#temporals.format(rating.appointment.endTime, 'dd-MM-yyyy HH:mm')}"></td> <td th:text="${#temporals.format(rating.createdAt, 'dd-MM-yyyy HH:mm')}"></td> <td>
                <form th:action="@{/admin/ratings/delete/{id}(id=${rating.id})}" method="post"
                      onsubmit="return confirm('Bạn có chắc chắn muốn xóa đánh giá này không?');">
                    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
                    <button type="submit" class="btn btn-danger btn-sm">Xóa</button>
                </form>
            </td>
            </tr>
            <tr th:if="${ratingPage.content.isEmpty()}">
                <td colspan="10" class="text-center">Không có đánh giá nào phù hợp.</td>
            </tr>
            </tbody>
        </table>
    </div>

    <div class="pagination-controls" th:if="${ratingPage.totalPages > 1}">
        <a th:href="@{/admin/ratings(page=${currentPage - 1}, size=${pageSize}, sortBy=${sortBy}, sortDir=${sortDir}, searchTerm=${searchTerm})}"
           th:classappend="${currentPage == 0 ? 'disabled' : ''}"
           class="btn btn-outline-primary">&laquo; Trước</a>

        <span class="mx-2">
            Trang <span th:text="${currentPage + 1}"></span> của <span th:text="${ratingPage.totalPages}"></span>
        </span>

        <a th:href="@{/admin/ratings(page=${currentPage + 1}, size=${pageSize}, sortBy=${sortBy}, sortDir=${sortDir}, searchTerm=${searchTerm})}"
           th:classappend="${currentPage + 1 == ratingPage.totalPages ? 'disabled' : ''}"
           class="btn btn-outline-primary">Tiếp &raquo;</a>
    </div>
</div>
<div th:replace="~{fragments/footer :: footer}"></div>

<!-- JavaScript Files -->
<!--<< All JS Plugins >>-->
<script src="/assets/js/jquery-3.7.1.min.js"></script>
<!--<< Viewport Js >>-->
<script src="/assets/js/viewport.jquery.js"></script>
<!--<< Bootstrap Js >>-->
<script src="/assets/js/bootstrap.bundle.min.js"></script>
<!--<< nice-selec Js >>-->
<script src="/assets/js/jquery.nice-select.min.js"></script>
<!--<< Waypoints Js >>-->
<script src="/assets/js/jquery.waypoints.js"></script>
<!--<< Counterup Js >>-->
<script src="/assets/js/jquery.counterup.min.js"></script>
<!--<< Swiper Slider Js >>-->
<script src="/assets/js/swiper-bundle.min.js"></script>
<!--<< MeanMenu Js >>-->
<script src="/assets/js/jquery.meanmenu.min.js"></script>
<!--<< Magnific Popup Js >>-->
<script src="/assets/js/jquery.magnific-popup.min.js"></script>
<!--<< Wow Animation Js >>-->
<script src="/assets/js/wow.min.js"></script>
<!--<< Main.js >>-->
<script src="/assets/js/main.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>